{% extends "base.html" %}

{% block jumbo %}
<div class="jumbotron jumbotron-fluid bg-light">
    <div class="container text-center">
        <h1 class="display-4 font-weight-bolder"><span style="color:#6BBA70">COPE</span>VID-19</h1>
        <h2>Supply Tracker</h2>
        <p class="lead">Help your neighbors track down essentials during periods of shortages.</p>
        <p><a class="btn btn-outline-primary btn-lg col-sm-12 col-md-3" href="{{ url_for('add') }}" role="button">Add an
            Update</a></p>
        <p><a class="btn btn-outline-primary btn-lg col-sm-12 col-md-3" href="{{ url_for('search') }}" role="button">Search
            for an Item</a></p>
    </div>
</div>
{% endblock %}

{% block content %}
{% if entries %}
<h2 class="text-center">Recent updates</h2>
<ul class="list-group list-group-flush">
    {% for entry in entries %}
    <li class="list-group-item">
        <div class="row">
            <div class="col-xs-6">
                {% if entry.quantity=='limited' %}
                {% set qty = 'Limited Stock' %}
                <span style="color:tomato"><i class="fas fa-exclamation-circle fa-2x mt-3"></i></span>
                {% elif entry.quantity=='stocked' %}
                {% set qty = 'Stocked' %}
                <span style="color:mediumseagreen"><i class="fas fa-thumbs-up fa-2x mt-3"></i></span>
                {% else %}
                {% set qty = 'Out of Stock' %}
                <span style="color:crimson"><i class="fas fa-ban fa-2x mt-3"></i></span>
                {% endif %}
            </div>
            <div class="col">
                <h5>{{entry.item | title}} - {{qty}} <span class="small text-muted">({{entry.timestamp | humanize}})</span></h5>
              <p><strong>{{entry.business}}</strong> | <a href="https://maps.google.com/?q={{entry.address}}" target="_blank">{{entry.address}}</a></p>
            </div>
        </div>
    </li>
    {% endfor %}
</ul>
{% endif %}
{% endblock %}

{% block footer %}
<div id="installbar" class="invisible">
    <nav class="navbar fixed-bottom navbar-light bg-dark">
        <span class="text-light">Add to your Home Screen</span>
        <form class="form-inline">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit" id="installbtn">Install</button>
        </form>
    </nav>
</div>
{% endblock %}

{% block js %}
<script>
if ('serviceWorker' in navigator) { navigator.serviceWorker.register('/service-worker.js'); }

const shareData = {
  title: 'Supply Tracker',
  text: 'Help your neighbors find essential items due to shortages from COVID-19',
  url: 'https://ojaved20.pythonanywhere.com',
}

const btn = document.getElementById('installbtn');

btn.addEventListener('click', async () => {
  try {
    navigator.share(shareData)
    window.alert('Success');
  } catch(err) {
    window.alert(err);
  }
});

function needsToSeePrompt() {
  if (navigator.standalone) {
    return false;
  }
  var isApple = ['iPhone', 'iPad', 'iPod'].includes(navigator.platform);
  return isApple;
}

if (needsToSeePrompt() == true) {
    const installbar = document.getElementById('installbar');
    installbar.classList.remove('invisible');
};

</script>
{% endblock %}